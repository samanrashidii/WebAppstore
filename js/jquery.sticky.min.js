/*
Plugin Name: Sticky
Plugin URI:  http://norththemes.com/product/sticky/
Version:     1.0.1
*/
!function($,window,undefined){"use strict";function scrollHandler(){var i;for(scrollTop=$window.scrollTop(),scrollSpeed=scrollTop-scrollTopSave,scrollTopSave=scrollTop,i=sticksList.length-1;i>=0;i-=1)sticksList[i].getSetting("autoRefresh")&&sticksList[i].refresh()}function resizeHandler(){var i;for(windowHeight=$window.innerHeight(),scrollTop=$window.scrollTop(),scrollSpeed=0,scrollTopSave=scrollTop,i=sticksList.length-1;i>=0;i-=1)sticksList[i].getSetting("autoRecalculate")&&(sticksList[i].refreshParent(),sticksList[i].recalculate(),sticksList[i].refresh())}function Stick(element,settings){settings=$.extend({},defaults,$.sticky.defaults,settings);var locked,topEdge,bottomEdge,parentStart,actualTopEdge,topFixedValue,fitInViewport,maxMiddleOffset,bottomFixedValue,actualBottomEdge,actualMiddleOffset,actualTopEdgeOffset,bottomAbsoluteValue,actualBottomEdgeOffset,parentRelativeTopOffset,lastBottomAbsoluteValue,parentRelativeBottomOffset,$parent,$element,$placeholder,$firstPositioned,defaultElementCSS,state="basic";this.constructor=function(){$element=$(element),defaultElementCSS={top:element.style.top,left:element.style.left,width:element.style.width,bottom:element.style.bottom,position:element.style.position,marginTop:element.style.marginTop,marginBottom:element.style.marginBottom},this.createPlaceholder(),this.refreshParent(),this.recalculate(),this.refresh(),$element.data("sticky",this)},this.refreshParent=function(){for($parent=$element.parent(),$firstPositioned=!1;!$parent.is("html")&&(settings.parent&&!$parent.is(settings.parent)||!settings.parent&&"static"===$parent.css("position"));)$parent.parent().length&&"static"!==$parent.css("position")&&!$firstPositioned&&($firstPositioned=$parent),$parent=$parent.parent();"static"!==$parent.css("position")||$firstPositioned||$parent.css("position","relative")},this.createPlaceholder=function(){$placeholder=$("<div/>").addClass(settings.placeholder),settings.placeholder&&$element.after($placeholder)},this.removePlaceholder=function(){$placeholder.detach()},this.recalculate=function(){function getCSSValues($e,props){var k,css=$e.css(props);for(k in css)css.hasOwnProperty(k)&&(css[k]=parseInt(css[k],10)||0);return css}scrollSpeed=0,$placeholder.hide();var topValue,bottomValue,savedElementCSS={top:element.style.top,bottom:element.style.bottom,position:element.style.position,marginTop:element.style.marginTop,marginBottom:element.style.marginBottom},i=$element.css(defaultElementCSS),cssProperties=["marginTop","marginBottom","paddingTop","paddingBottom","borderTopWidth","borderBottomWidth"],elementCSS=getCSSValues($element,cssProperties),parentCSS=getCSSValues($parent,cssProperties),placeholderCSS=$element.css(["marginLeft","marginTop","marginRight","marginBottom","float","display","position","left","top","bottom","right"]),sizingTranslation={"margin-box":1,"border-box":2,"padding-box":3,"content-box":4},elementBox=sizingTranslation[settings.elementBox]||3,parentBox=sizingTranslation[settings.parentBox]||1,propertiesTopHierarchy=["marginTop","borderTopWidth","paddingTop"],propertiesBottomHierarchy=["marginBottom","borderBottomWidth","paddingBottom"],elementOffset=$element.offset().top-elementCSS.marginTop,parentOffset=$parent.offset().top-parentCSS.marginTop,viewportHeight=windowHeight-settings.top-settings.bottom,parentBottom=parentOffset+$parent.outerHeight(!0),activeHeight=$element.outerHeight(!0);for($firstPositioned?(settings.placeholder||$element.hide(),parentRelativeTopOffset=$parent.offset().top-$firstPositioned.offset().top,parentRelativeBottomOffset=$firstPositioned.offset().top+(parseInt($firstPositioned.css("borderTopWidth"))||0)+$firstPositioned.innerHeight()-($parent.offset().top+(parseInt($parent.css("borderTopWidth"))||0)+$parent.innerHeight()),settings.placeholder||$element.show()):(parentRelativeTopOffset=0,parentRelativeBottomOffset=0),locked=Math.ceil(elementOffset+activeHeight)>=Math.floor(parentBottom-parentCSS.marginBottom-parentCSS.borderBottomWidth-parentCSS.paddingBottom),topEdge=elementOffset-settings.top,parentStart=parentOffset+parentCSS.marginTop+parentCSS.borderTopWidth,topFixedValue=elementCSS.marginTop+settings.top,maxMiddleOffset=$parent.innerHeight()+parentCSS.borderBottomWidth+parentCSS.marginBottom-$element.outerHeight()-elementCSS.marginBottom,bottomFixedValue=elementCSS.marginBottom+settings.bottom,bottomAbsoluteValue=settings.bottomSpace-parentCSS.borderBottomWidth-parentCSS.marginBottom+elementCSS.marginBottom+parentRelativeBottomOffset,actualTopEdgeOffset=-settings.top-elementCSS.marginTop,actualBottomEdgeOffset=settings.bottom+$element.outerHeight()+elementCSS.marginBottom-windowHeight,i=0;elementBox-1>i;i+=1)topValue=elementCSS[propertiesTopHierarchy[i]],bottomValue=elementCSS[propertiesBottomHierarchy[i]],topEdge+=topValue,activeHeight-=topValue+bottomValue,topFixedValue-=topValue,maxMiddleOffset+=bottomValue,bottomFixedValue-=bottomValue,actualTopEdgeOffset+=topValue,bottomAbsoluteValue-=bottomValue,actualBottomEdgeOffset-=bottomValue;for(i=0;parentBox-1>i;i+=1)bottomValue=parentCSS[propertiesBottomHierarchy[i]],parentBottom-=bottomValue,maxMiddleOffset-=bottomValue,bottomAbsoluteValue+=bottomValue;fitInViewport=viewportHeight>=activeHeight,bottomEdge=settings.stickToBottom||!fitInViewport&&settings.scrollable?parentBottom-windowHeight-settings.bottomSpace+settings.bottom:parentBottom-activeHeight-settings.bottomSpace-settings.top,!settings.stickToBottom||!fitInViewport&&settings.scrollable||(topEdge=$element.offset().top+actualBottomEdgeOffset),$placeholder.css(placeholderCSS).css({width:$element.outerWidth(),height:$element.outerHeight()}).hide(),("topFixed"===state||"bottomFixed"===state)&&$element.css("left",$element.offset().left),$element.css("width",$element.width()).css(savedElementCSS),"middle"===state&&actualMiddleOffset>maxMiddleOffset&&($element.css("top",maxMiddleOffset),actualMiddleOffset=maxMiddleOffset),"basic"!==state&&$placeholder.show(),elementOffset=$element.offset().top,actualTopEdge=elementOffset+actualTopEdgeOffset,actualBottomEdge=elementOffset+actualBottomEdgeOffset,$element.trigger("sticky:recalculate")},this.changeState=function(newState){if(state===newState)return void("bottom"===state&&lastBottomAbsoluteValue!==bottomAbsoluteValue&&(element.style.bottom=bottomAbsoluteValue+"px",lastBottomAbsoluteValue=bottomAbsoluteValue));var elementOffset,k,newCSS={top:"",bottom:"",left:""};switch($element.removeClass("is-top-fixed is-hanged is-bottom-fixed is-bottomed"),newState){case"topFixed":newCSS.top=topFixedValue+"px",newCSS.left=$element.offset().left+"px",newCSS.position="fixed",$element.addClass("is-top-fixed");break;case"middle":actualMiddleOffset=$element.offset().top-parentStart+parentRelativeTopOffset,actualMiddleOffset>maxMiddleOffset&&(actualMiddleOffset=maxMiddleOffset),newCSS.top=actualMiddleOffset+"px",newCSS.position="absolute",$element.addClass("is-hanged");break;case"bottomFixed":newCSS.bottom=bottomFixedValue+"px",newCSS.left=$element.offset().left+"px",newCSS.position="fixed",$element.addClass("is-bottom-fixed");break;case"bottom":newCSS.bottom=bottomAbsoluteValue+"px",newCSS.position="absolute",$element.addClass("is-bottomed"),lastBottomAbsoluteValue=bottomAbsoluteValue}"basic"===newState?($placeholder.hide(),newCSS=defaultElementCSS,$element.trigger("sticky:unstick")):"basic"===state&&($placeholder.show(),newCSS.width=$element.width()+"px",newCSS.marginTop="0",newCSS.marginBottom="0",$element.trigger("sticky:stick"));for(k in newCSS)newCSS.hasOwnProperty(k)&&(element.style[k]=newCSS[k]);elementOffset=$element.offset().top,actualTopEdge=elementOffset+actualTopEdgeOffset,actualBottomEdge=elementOffset+actualBottomEdgeOffset,"basic"===newState&&(actualTopEdge=topEdge),$element.trigger("sticky:statechange",[newState,state]),state=newState},this.refresh=function(){(topEdge>=scrollTop||topEdge>actualTopEdge||locked)&&!settings.alwaysFixed?this.changeState("basic"):bottomEdge>scrollTop?fitInViewport||!settings.scrollable?this.changeState(settings.stickToBottom?"bottomFixed":"topFixed"):scrollSpeed>=0?("topFixed"===state&&this.changeState("middle"),scrollTop>actualBottomEdge&&this.changeState("bottomFixed")):("bottomFixed"===state&&this.changeState("middle"),actualTopEdge>scrollTop&&this.changeState("topFixed")):this.changeState("bottom"),$element.trigger("sticky:refresh")},this.getSetting=function(settingName){return settings[settingName]},this.config=function(newOptions){settings=$.extend(settings,newOptions),this.refreshParent(),this.removePlaceholder(),this.createPlaceholder(),this.recalculate(),this.refresh()},this.destroy=function(){var i;for(i=sticksList.length-1;i>=0;i-=1)sticksList[i]===this&&sticksList.splice(i,1);this.changeState("basic"),this.removePlaceholder(),$element.data("sticky",undefined),$element.trigger("sticky:destroy")},this.constructor()}var scrollTop,scrollSpeed,windowHeight,scrollTopSave,sticksList=[],$window=$(window),defaults={top:0,bottom:0,parent:"",parentBox:"content-box",elementBox:"border-box",scrollable:!0,placeholder:"sticky-placeholder",bottomSpace:0,autoRefresh:!0,alwaysFixed:!1,stickToBottom:!1,autoRecalculate:!0};$window.scroll(scrollHandler),$window.resize(resizeHandler),resizeHandler(),scrollHandler(),$.sticky=function(element,primary,secondary){var stick,functions={config:"config",destroy:"destroy",refresh:"refresh","get-setting":"getSetting",recalculate:"recalculate","refresh-parent":"refreshParent","remove-placeholder":"removePlaceholder","create-placeholder":"createPlaceholder"};if("string"==typeof primary||primary instanceof String){if(stick=$(element).data("sticky"),primary=primary.toLowerCase(),!stick||!functions[primary])return void(window.console&&window.console.warn&&window.console.warn(functions[primary]?"Sticky: You can't use "+primary+" function before Sticky initialization":"Sticky: Not supported "+primary+" function"));stick[functions[primary]](secondary)}else sticksList.push(new Stick(element,primary))},$.sticky.defaults=defaults,$.fn.sticky=function(primary,secondary){return this.each(function(){$.sticky(this,primary,secondary)})}}(jQuery,window);